# Verifying Trusted Setup Ceremony

A trusted setup ceremony is a fundamental process in ensuring the integrity and security of certain cryptographic systems. 
By generating a unique and unpredictable “number” collectively, with contributions from multiple parties, 
we create a foundation of trust that prevents malicious actors from compromising the system.

Verifying the security of our ceremony is paramount. However, it's important to note that it's a more technical process than contributing. 
We invite everyone to confirm the security of our ceremony for themselves, and so are publishing this guide to help you do so.


## Overview
There are multiple steps to verifying the security of a trusted setup ceremony. We provide the required list in a way 
that malicious projects pretend to run rituals while secretly retaining backdoors. 
To ensure that anyone can verify the integrity of our trusted setup ceremony, we have outlined a robust guide for 
verifying the results. Here’s an overview of the key steps involved:

- Verifying the circuit we are securing does not include security holes;
- Verifying the transcript matches the circuit;
- Verifying contributors' attestations match the transcript;

## Verifying the Circuit
Confirming the integrity and security of the [EthStorage blob poseidon circuit](https://github.com/ethstorage/zk-decoder/blob/main/circom/circuits/blob_poseidon_2.circom) 
by reviewing our circom code, which is open-source and available on Github.

## Verifying the Transcript Matches the Circuit
Our ceremony transcript is included in the zkey published on ceremony.ethstorage.io in the "Download ZKey" tab of the 
[EthStorage Circom page](https://ceremony.ethstorage.io/projects/EthStorage%20circom). You can verify it matches the 
circuit using Circom and snarkjs:

- Install [Circom](https://docs.circom.io/getting-started/installation/) and [snarkjs](https://github.com/iden3/snarkjs).
- Clone circom code https://github.com/ethstorage/zk-decoder.
- Download the Powers of Tau (ptau) file we used for our ceremony; we used the Hermez rollup with 2^20 powers of tau, 
which is linked in [the snarkjs readme](https://github.com/privacy-scaling-explorations/perpetualpowersoftau?tab=readme-ov-file#prepared-phase-2-files) 
or available directly [here](https://pse-trusted-setup-ppot.s3.eu-central-1.amazonaws.com/pot28_0080/ppot_0080_20.ptau).
- Generate the `r1cs` file from the `circom` source files, by running `circom blob_poseidon_2.circom --r1cs` in the 
directory `zk-decoder/circom/circuits` (need to run `npm install` for the first time). The SHA-256 hash of this file
(i.e. as computed by `sha256sum blob_poseidon_2.r1cs`) is `ba17a94a5edcc1d0b0ad10990e0aea4894f080ce571b0db79fb1c3a9c4a74a0d`
- Use snarkjs to verify that the transcript matches this circuit and powers of tau, by running 
`snarkjs zkey verify blob_poseidon_2.r1cs ppot_0080_20.ptau blob_poseidon_2_final.zkey`. blob_poseidon_2_final.zkey can be download 
[here](https://ethstorage-circom-ph2-ceremony.s3.us-west-2.amazonaws.com/circuits/blob_poseidon_2/contributions/blob_poseidon_2_final.zkey).
You should see a list of contribution hashes (attestations) followed by the message snarkJS: `ZKey Ok!`.


## Verifying Contributor Attestations Match the Transcript

Each contributor authorized our ceremony to publish an attestation to their GitHub account. (In a Gist entitled 
"`ethstorage-circom_attestation.log`") These attestations match the attestations published in the transcript. 
This proves which GitHub user made each contribution to the ceremony. You can verify attestations by looking them 
up both in the transcript and on GitHub:

In the transcript (generated by snarkjs in the previous step), you will see that each contribution is preceded 
by the phrase contribution `#[number] [username]-[number]`. That username is the GitHub username.

On GitHub, you can run a search to find an attestation Gist on gist.github.com. For example, if the username is 
`somecontributor`, then you could search for filename:`"ethstorage-circom_attestation.log" user:somecontributor`.

To verify an attestation, confirm that the hash in the attestation in the transcript matches the hash in the 
GitHub Gist for that same user.

**Important Note**: Contributors can remove their attestations from GitHub at any time. They can also edit their 
attestations (although in this case the edit history will be visible). Only the original version of the attestation 
can be valid; an edited version cannot be a valid attestation. Note that if any malicious contributors were 
able to participate in the ceremony, it does not damage the security of the ceremony, but it does mean that they 
can pretend to have a bad attestation by editing or deleting their Gist. Therefore, a contribution with no attestation 
provides no security to the ceremony.

Please exercise good judgment about whether a missing or edited attestation represents:

- A malicious contributor
- Someone just cleaning up old Gists
- A problem in the ceremony

